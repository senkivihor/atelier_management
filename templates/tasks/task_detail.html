{% extends 'base.html' %}

{% block title %}{{ task.title }}{% endblock %}

{% block content %}
    <hgroup>
        <h1>{{ task.title }}</h1>
        <h2>Task Details</h2>
    </hgroup>

    <p><strong>Client:</strong> <a href="{% url 'client_detail' task.client.pk %}">{{ task.client.get_full_name }}</a></p>
    <p><strong>Status:</strong> {{ task.get_status_display }}</p>
    <p><strong>Deadline:</strong> <span class="{% if task.is_overdue %}is-overdue{% elif task.is_due_soon %}is-due-soon{% endif %}">
        {% if task.deadline %}{{ task.deadline|date:"M d, Y" }}{% else %}No deadline{% endif %}
    </span></p>
    <p><strong>Description:</strong> {{ task.description|linebreaksbr|default:"No description provided." }}</p>
    <p><strong>Created:</strong> {{ task.created_at|date:"M d, Y H:i" }}</p>
    {% if task.completed_at %}
        <p><strong>Completed On:</strong> {{ task.completed_at|date:"M d, Y H:i" }}</p>
    {% endif %}

    <a href="{% url 'task_list' %}" role="button" class="secondary">Back to Tasks</a>
    <a href="#" role="button" hx-get="{% url 'task_update' task.pk %}" hx-target="#dialog-container" hx-swap="outerHTML" hx-on--after-request="document.querySelector('#update-task-modal-{{ task.pk }}').showModal()">Edit Task</a>

    {% if task.status == 'pending' %}
        <button class="primary" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "in_progress"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Mark this task 'In Progress'?" hx-trigger="click">Start Work</button>
    {% elif task.status == 'in_progress' %}
        <button class="primary" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "completed"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Mark this task 'Completed'?" hx-trigger="click">Mark Completed</button>
        <button class="secondary" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "on_hold"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Put this task 'On Hold'?" hx-trigger="click">Put On Hold</button>
    {% elif task.status == 'on_hold' %}
        <button class="primary" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "in_progress"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Resume 'In Progress'?" hx-trigger="click">Resume Work</button>
        <button class="secondary" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "completed"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Mark this task 'Completed'?" hx-trigger="click">Mark Completed</button>
    {% endif %}
    <button class="contrast" hx-post="{% url 'task_update_status' task.pk %}" hx-vals='{"status": "cancelled"}' hx-target="closest article" hx-swap="outerHTML" hx-confirm="Cancel this task?" hx-trigger="click">Cancel Task</button>

    <div id="dialog-container"></div>
{% endblock %}